#!/bin/bash
# Post-installation script for SCANOSS Code Compare
# This script creates a symlink in /usr/local/bin to make scanoss-cc available in PATH

set -e

APP_NAME="SCANOSS Code Compare"
APP_PATH="/Applications/${APP_NAME}.app"
BINARY_PATH="${APP_PATH}/Contents/MacOS/${APP_NAME}"
SYMLINK_PATH="/usr/local/bin/scanoss-cc"

echo "Creating symlink for scanoss-cc..."

# Create /usr/local/bin if it doesn't exist
if [ ! -d "/usr/local/bin" ]; then
    echo "Creating /usr/local/bin directory..."
    mkdir -p /usr/local/bin
    chmod 755 /usr/local/bin
fi

# Remove existing symlink if it exists
if [ -L "$SYMLINK_PATH" ]; then
    echo "Removing existing symlink..."
    rm -f "$SYMLINK_PATH"
fi

# Create new symlink
if [ -f "$BINARY_PATH" ]; then
    echo "Creating symlink: $SYMLINK_PATH -> $BINARY_PATH"
    ln -s "$BINARY_PATH" "$SYMLINK_PATH"
    chmod 755 "$SYMLINK_PATH"
    echo "Symlink created successfully!"
    echo "You can now run 'scanoss-cc' from any terminal."
else
    echo "Warning: Application binary not found at $BINARY_PATH"
    exit 0  # Don't fail the installation
fi

exit 0
